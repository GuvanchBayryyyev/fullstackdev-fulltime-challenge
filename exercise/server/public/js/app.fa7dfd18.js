(function(e){function t(t){for(var s,i,a=t[0],c=t[1],l=t[2],d=0,p=[];d<a.length;d++)i=a[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&p.push(r[i][0]),r[i]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);u&&u(t);while(p.length)p.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],s=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(s=!1)}s&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var s={},r={app:0},o=[];function i(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=s,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var s=n("85ec"),r=n.n(s);r.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{attrs:{id:"icon"}},[n("b-icon",{attrs:{icon:"shield-lock","font-scale":"7.5"}})],1),n("LockerComponent")],1)},o=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{attrs:{fluid:"sm"}},[n("b-table",{ref:"lockingTable",attrs:{selectable:"","select-mode":e.selectMode,items:e.lockings,fields:e.fields,responsive:"sm",busy:e.isBusy},on:{"row-selected":e.onRowSelected},scopedSlots:e._u([{key:"cell(status)",fn:function(e){return[n("b-icon",{attrs:{"font-scale":"1.5",icon:e.item.status}})]}},{key:"table-busy",fn:function(){return[n("div",{staticClass:"text-center text-danger my-2"},[n("b-spinner",{staticClass:"align-middle"}),n("strong",[e._v("Loading...")])],1)]},proxy:!0}])}),n("p",[n("b-button",{attrs:{disabled:e.notChosen,size:"sm"},on:{click:e.choose}},[e._v("Choose")])],1),n("p",{staticClass:"warning"},[e._v(" "+e._s(e.warning)+" ")]),e.lockingProcess?n("div",[e.chargeExtra?n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Additional Payment: "+e._s(this.extraCharge)+"THB")])]):e._e(),n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Insert Bill here:")]),n("b-form-input",{attrs:{id:"input-live",state:e.billState,"aria-describedby":"input-live-help input-live-feedback",type:"number",trim:""},model:{value:e.bill,callback:function(t){e.bill=t},expression:"bill"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Insert one of these: 20 THB, 50 THB, 100 THB, 500 THB and 1000 THB ")])],1),n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Insert Coin here:")]),n("b-form-input",{attrs:{id:"input-live",state:e.coinState,"aria-describedby":"input-live-help input-live-feedback",type:"number",trim:""},model:{value:e.coin,callback:function(t){e.coin=t},expression:"coin"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Insert one of these: 1 THB, 2 THB, 5 THB, 10 THB ")])],1),0==e.chargeExtra?n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Set Password:")]),n("b-form-input",{attrs:{id:"input-live",state:e.passState,"aria-describedby":"input-live-help input-live-feedback",type:"password",trim:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Use 6 characters ")]),n("b-form-text",{attrs:{id:"input-live-help"}},[e._v("Use birthday to remember easily")])],1):e._e(),0==e.chargeExtra?n("p",[n("b-button",{attrs:{disabled:(!e.passState||!e.billState)&&(!e.passState||!e.coinState),size:"sm"},on:{click:function(t){return e.handleAction("lock")}}},[e._v("Lock")])],1):e._e()]):e._e(),e.unlockingProcess?n("div",[n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Enter Password to unlock:")]),n("b-form-input",{attrs:{id:"input-live",state:e.passStateUnlock,"aria-describedby":"input-live-help input-live-feedback",type:"password",trim:""},model:{value:e.passwordUnlock,callback:function(t){e.passwordUnlock=t},expression:"passwordUnlock"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Use 6 characters ")]),n("b-form-text",{attrs:{id:"input-live-help"}},[e._v("Enter correct password! (maybe birthday...)")])],1),e.change>0&&e.passStateUnlock?n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Here is your change: "+e._s(e.changes)+"THB")])]):e._e(),n("p",[n("b-button",{attrs:{disabled:!e.passStateUnlock,size:"sm"},on:{click:function(t){return e.handleAction("unlock")}}},[e._v("Unlock")])],1)]):e._e(),n("b-modal",{attrs:{id:"modal-done","hide-footer":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[e.notChosen?e._e():n("div",[e._v("Successfully "),n("code",[e._v(e._s("lock"==e.currentStatus?"UNLOCK":"LOCK")+"ED")]),e._v(" Unit "),n("code",[e._v(e._s(e.currentUnit))])])]},proxy:!0}])},[n("div",{staticClass:"d-block text-center"},[e.notChosen||"lock"!=e.currentStatus?e._e():n("h3",[e._v("Thanks for using our system!")]),e.notChosen||"unlock"!=e.currentStatus?e._e():n("div",[e._v("See you later!"),n("br"),n("p",{staticClass:"grey-text"},[e._v("Do not forget your password to "),n("code",[e._v("unlock")])])])])]),n("b-modal",{attrs:{id:"modal-contact","hide-footer":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[n("div",[e._v("Cannot Get Item Back ")])]},proxy:!0}])},[n("div",{staticClass:"d-block text-center"},[n("h3",[e._v("You need to pay "),n("code",[e._v(e._s(e.extraCharge)+"THB")]),e._v(" to UNLOCK")]),n("div",[n("p",{staticClass:"grey-text"},[e._v("Contact the staff for "),n("code",[e._v("extra")]),e._v(" fee payment")])])])])],1)},a=[],c=(n("99af"),n("96cf"),n("1da1")),l=(n("d81d"),n("d3b7"),n("5530")),u=n("d4ec"),d=n("bee2"),p=n("bc3a"),f=n.n(p),h="api/lockers/",v=function(){function e(){Object(u["a"])(this,e)}return Object(d["a"])(e,null,[{key:"getLockings",value:function(){return new Promise((function(e,t){f.a.get(h).then((function(t){var n=t.data;e(n.map((function(e){return Object(l["a"])({},e)})))})).catch((function(e){t(e)}))}))}},{key:"updateLocking",value:function(e,t,n,s,r,o,i,a){return f.a.put("".concat(h).concat(e),{unit:t,size:n,firstprice:s,nextprice:r,status:o,payment:i,password:a})}},{key:"deleteLocking",value:function(e){return f.a.delete("".concat(h).concat(e))}}]),e}(),b=v,g={name:"LockerComponent",props:{msg:String},data:function(){return{error:"",text:"",fields:["status","unit","size",{key:"firstprice",label:"First Price(60min)"},{key:"nextprice",label:"Next 60 mins"}],lockings:[],selectMode:"single",selected:[],isBusy:!0,warning:"",notChosen:!0,bill:null,coin:null,password:"",passwordUnlock:"",lockingProcess:!1,unlockingProcess:!1,chargeExtra:!1,change:0,changes:[],extraCharge:0,currentStatus:"",currentUnit:0}},created:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b.getLockings();case 3:e.lockings=t.sent,e.isBusy=!1,console.log("Select and click 'Choose'"),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.error=t.t0.message;case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},methods:{onRowSelected:function(e){this.selected=e,this.notChosen=!1,this.unlockingProcess=!1,this.lockingProcess=!1,this.warning=""},choose:function(){this.chargeExtra=!1;var e=this.selected[0];if(this.currentUnit=e.unit,this.currentStatus=e.status,"lock"==e.status){this.unlockingProcess=!0,console.log("Enter password: "+e.password);var t=this.calculatePayment(e.lockedDate),n=e.payment;if(console.log("charge: "+t+"THB"),console.log("paid before: "+n+"THB"),this.extraCharge=t,n<t)this.unlockingProcess=!1,this.chargeExtra=!0,console.log("additional payment..."),console.log("please pay: "+(t-n)+"THB. Contact the staff"),this.extraCharge=t-n,this.$bvModal.show("modal-contact");else if(n>t){var s=n-t;this.change=s;var r=[1e3,500,100,50,20,10,5,2,1],o=[],i=0;console.log("Changes are:");for(var a=0;a<r.length;a++)if(i=0,s>=r[a]){while(s/r[a]>=1)s-=r[a],i++;console.log(i+" x "+r[a]),o.push("".concat(i,"x").concat(r[a]))}this.changes=o,console.log("total change: "+this.change)}else this.unlockingProcess=!0}else this.chargeExtra=!1,this.lockingProcess=!0},calculatePayment:function(e){var t=(new Date).getTime(),n=new Date(e).getTime(),s=(t-n)/1e3;s/=60;var r=Math.abs(Math.round(s));console.log("total minutes is: "+r+"min");var o=0,i=this.selected[0].firstprice,a=this.selected[0].nextprice;if(r<61)o=i;else{o+=i;while(r>60)o+=a,r-=60}return o},lock:function(e,t,n,s,r){var o=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var a,c,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a="lock",c=+o.bill+ +o.coin,l=o.password,o.isBusy=!0,i.next=6,b.updateLocking(e,t,n,s,r,a,c,l);case 6:return i.next=8,b.getLockings();case 8:o.lockings=i.sent,o.$bvModal.show("modal-done"),o.isBusy=!1;case 11:case"end":return i.stop()}}),i)})))()},unlock:function(e,t,n,s,r){var o=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var a,c,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a="unlock",c=0,l=null,o.isBusy=!0,i.next=6,b.updateLocking(e,t,n,s,r,a,c,l);case 6:return i.next=8,b.getLockings();case 8:o.lockings=i.sent,o.$bvModal.show("modal-done"),o.isBusy=!1;case 11:case"end":return i.stop()}}),i)})))()},handleAction:function(e){this.lockingProcess=!1,this.unlockingProcess=!1,this.notChosen=!0;var t=this.selected[0]._id,n=this.selected[0].unit,s=this.selected[0].size,r=this.selected[0].firstprice,o=this.selected[0].nextprice;"lock"==e?this.lock(t,n,s,r,o):this.unlock(t,n,s,r,o),this.bill=null,this.coin=null,this.password="",this.passwordUnlock=""}},computed:{billState:function(){return 20==this.bill||50==this.bill||100==this.bill||500==this.bill||1e3==this.bill},coinState:function(){return 1==this.coin||2==this.coin||5==this.coin||10==this.coin},passState:function(){return 6==this.password.length},passStateUnlock:function(){return this.passwordUnlock==this.selected[0].password}}},k=g,m=(n("c6b5"),n("2877")),y=Object(m["a"])(k,i,a,!1,null,"6118c881",null),_=y.exports,w=n("5f5b"),x=n("b1e0");n("f9e3"),n("2dd8");s["default"].use(w["a"]),s["default"].use(x["a"]);var S={name:"App",components:{LockerComponent:_}},C=S,P=(n("034f"),Object(m["a"])(C,r,o,!1,null,null,null)),B=P.exports;s["default"].config.productionTip=!1,new s["default"]({render:function(e){return e(B)}}).$mount("#app")},"85ec":function(e,t,n){},c6b5:function(e,t,n){"use strict";var s=n("db20"),r=n.n(s);r.a},db20:function(e,t,n){}});
//# sourceMappingURL=app.fa7dfd18.js.map