(function(e){function t(t){for(var r,i,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(p.length)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("85ec"),o=n.n(r);o.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"header"},[n("b-icon",{attrs:{id:"icon",icon:"shield-lock","font-scale":"7.5"}}),e._m(0)],1),n("LockerComponent")],1)},a=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h3",[e._v("Welcome to Coin Locker System!")])])}],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{staticStyle:{"overflow-y":"scroll"},attrs:{fluid:"sm"}},[n("b-table",{ref:"lockingTable",attrs:{selectable:!this.loading&&(!this.unlocking&&!this.locking),"select-mode":e.selectMode,items:e.lockings,fields:e.fields,responsive:"sm",busy:e.isBusy,"primary-key":""},on:{"row-selected":e.onRowSelected},scopedSlots:e._u([{key:"cell(status)",fn:function(e){return[n("b-icon",{attrs:{"font-scale":"1.5",icon:e.item.status}})]}},{key:"table-busy",fn:function(){return[n("div",{staticClass:"text-center text-danger my-2"},[n("b-spinner",{staticClass:"align-middle"}),n("strong",[e._v("Loading...")])],1)]},proxy:!0}])}),n("p",[n("b-button",{attrs:{disabled:e.btnChooseDisabled,variant:"dark"},on:{click:e.choose}},[e.loading||e.locking||e.unlocking?n("b-spinner",{attrs:{small:"",type:"grow"}}):e._e(),e._v(" "+e._s(this.loading?"Loading...":this.locking?"Locking...":this.unlocking?"Unlocking":"Choose")+" ")],1)],1),n("p",{staticClass:"warning"},[e._v(" "+e._s(e.warning)+" ")]),e.lockingProcess?n("div",[e.chargeExtra?n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Additional Payment: "+e._s(this.extraCharge)+"THB")])]):e._e(),n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Insert Bill here:")]),n("b-form-input",{attrs:{id:"input-live",state:e.billState,"aria-describedby":"input-live-help input-live-feedback",type:"number",trim:""},model:{value:e.bill,callback:function(t){e.bill=t},expression:"bill"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Insert one of these: 20 THB, 50 THB, 100 THB, 500 THB and 1000 THB ")])],1),n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Insert Coin here:")]),n("b-form-input",{attrs:{id:"input-live",state:e.coinState,"aria-describedby":"input-live-help input-live-feedback",type:"number",trim:""},model:{value:e.coin,callback:function(t){e.coin=t},expression:"coin"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Insert one of these: 1 THB, 2 THB, 5 THB, 10 THB ")])],1),0==e.chargeExtra?n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Set Password:")]),n("b-form-input",{attrs:{id:"input-live",state:e.passState,"aria-describedby":"input-live-help input-live-feedback",type:"password",trim:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Use 6 characters ")]),n("b-form-text",{attrs:{id:"input-live-help"}},[e._v("Use birthday to remember easily")])],1):e._e(),0==e.chargeExtra?n("p",[n("b-button",{attrs:{disabled:(!e.passState||!e.billState)&&(!e.passState||!e.coinState),size:"sm"},on:{click:function(t){return e.handleAction("lock")}}},[e._v("Lock")])],1):e._e()]):e._e(),e.unlockingProcess?n("div",[n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Enter Password to unlock:")]),n("b-form-input",{attrs:{id:"input-live",state:e.passStateUnlock,"aria-describedby":"input-live-help input-live-feedback",type:"password",trim:""},model:{value:e.passwordUnlock,callback:function(t){e.passwordUnlock=t},expression:"passwordUnlock"}}),n("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v(" Use 6 characters ")]),n("b-form-text",{attrs:{id:"input-live-help"}},[e._v("Enter correct password! (maybe birthday...)")])],1),e.change>0&&e.passStateUnlock?n("div",{attrs:{role:"group"}},[n("label",{attrs:{for:"input-live"}},[e._v("Here is your change: "+e._s(e.changes)+"THB")])]):e._e(),n("p",[n("b-button",{attrs:{disabled:!e.passStateUnlock,size:"sm"},on:{click:function(t){return e.handleAction("unlock")}}},[e._v("Unlock")])],1)]):e._e(),n("b-modal",{attrs:{id:"modal-done","hide-footer":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[n("div",[e._v("Successfully "),n("code",[e._v(e._s("lock"==e.currentStatus?"UNLOCK":"LOCK")+"ED")]),e._v(" Unit "),n("code",[e._v(e._s(e.currentUnit))])])]},proxy:!0}])},[n("div",{staticClass:"d-block text-center"},["lock"==e.currentStatus?n("h3",[e._v("Thanks for using our system!")]):e._e(),"unlock"==e.currentStatus?n("div",[e._v("See you later!"),n("br"),n("p",{staticClass:"grey-text"},[e._v("Do not forget your password to "),n("code",[e._v("unlock")])])]):e._e()])]),n("b-modal",{attrs:{id:"modal-contact","hide-footer":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[n("div",[e._v("Cannot Get Item Back ")])]},proxy:!0}])},[n("div",{staticClass:"d-block text-center"},[n("h3",[e._v("You need to pay "),n("code",[e._v(e._s(e.extraCharge)+"THB")]),e._v(" to UNLOCK")]),n("div",[n("p",{staticClass:"grey-text"},[e._v("Contact the staff for "),n("code",[e._v("extra")]),e._v(" fee payment")])])])]),n("b-modal",{attrs:{id:"modal-data-changed","hide-footer":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[n("div",[e._v("Unit "),n("code",[e._v(e._s(e.currentUnit))]),e._v(" just changed by another user")])]},proxy:!0}])},[n("div",{staticClass:"d-block text-center"},[n("h5",[e._v("Please choose another unit")])])])],1)},s=[],c=(n("99af"),n("96cf"),n("1da1")),l=(n("d81d"),n("d3b7"),n("5530")),u=n("d4ec"),d=n("bee2"),p=n("bc3a"),f=n.n(p),h="api/lockers/",g=function(){function e(){Object(u["a"])(this,e)}return Object(d["a"])(e,null,[{key:"getLockings",value:function(){return new Promise((function(e,t){f.a.get(h).then((function(t){var n=t.data;e(n.map((function(e){return Object(l["a"])({},e)})))})).catch((function(e){t(e)}))}))}},{key:"updateLocking",value:function(e,t,n,r,o,a,i,s){return f.a.put("".concat(h).concat(e),{unit:t,size:n,firstprice:r,nextprice:o,status:a,payment:i,password:s})}},{key:"deleteLocking",value:function(e){return f.a.delete("".concat(h).concat(e))}},{key:"getLockingById",value:function(e){return f.a.get("".concat(h).concat(e))}}]),e}(),b=g,v={name:"LockerComponent",props:["status"],data:function(){return{error:"",text:"",fields:["status","unit","size",{key:"firstprice",label:"First Price(60min)"},{key:"nextprice",label:"Next 60 mins"}],lockings:[],selectMode:"single",selected:[],isBusy:!0,warning:"",btnChooseDisabled:!0,bill:null,coin:null,password:"",passwordUnlock:"",lockingProcess:!1,unlockingProcess:!1,chargeExtra:!1,change:0,changes:[],extraCharge:0,currentStatus:"",currentUnit:0,loading:!1,unlocking:!1,locking:!1}},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b.getLockings();case 3:e.lockings=t.sent,e.isBusy=!1,console.log("Select and click 'Choose'"),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.error=t.t0.message;case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},methods:{onRowSelected:function(e){this.selected=e,this.btnChooseDisabled=!1,this.unlockingProcess=!1,this.lockingProcess=!1,this.warning=""},choose:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r,o,a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,b.getLockings();case 4:e.lockings=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](1),e.error=t.t0.message;case 10:n=0;case 11:if(!(n<e.lockings.length)){t.next=22;break}if(e.selected[0].unit!=e.lockings[n].unit){t.next=19;break}if(e.selected[0].status==e.lockings[n].status){t.next=18;break}return e.currentUnit=e.lockings[n].unit,e.$bvModal.show("modal-data-changed"),e.loading=!1,t.abrupt("return");case 18:e.selected[0]=e.lockings[n];case 19:n++,t.next=11;break;case 22:e.loading=!1,e.chargeExtra=!1,r=e.selected[0],e.currentUnit=r.unit,e.currentStatus=r.status,"lock"==r.status?(e.unlockingProcess=!0,console.log("Enter password: "+r.password),o=e.calculatePayment(r.lockedDate),a=r.payment,console.log("charge: "+o+"THB"),console.log("paid before: "+a+"THB"),e.extraCharge=o,a<o?(e.unlockingProcess=!1,e.chargeExtra=!0,console.log("additional payment..."),console.log("please pay: "+(o-a)+"THB. Contact the staff"),e.extraCharge=o-a,e.$bvModal.show("modal-contact")):a>o?(i=a-o,e.change=i,s=[1e3,500,100,50,20,10,5,2,1],console.log("Changes are:"),e.changes=e.calculateChange(s,i),console.log("total change: "+e.change)):e.unlockingProcess=!0):(e.chargeExtra=!1,e.lockingProcess=!0);case 28:case"end":return t.stop()}}),t,null,[[1,7]])})))()},calculateChange:function(e,t){for(var n=[],r=0,o=0;o<e.length;o++)if(r=0,t>=e[o]){while(t/e[o]>=1)t-=e[o],r++;console.log(r+" x "+e[o]),n.push("".concat(r,"x").concat(e[o]))}return n},calculatePayment:function(e){var t=(new Date).getTime(),n=new Date(e).getTime(),r=(t-n)/1e3;r/=60;var o=Math.abs(Math.round(r));console.log("total minutes is: "+o+"min");var a=0,i=this.selected[0].firstprice,s=this.selected[0].nextprice;if(o<61)a=i;else{a+=i;while(o>60)a+=s,o-=60}return a},lock:function(e,t,n,r,o){var a=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var s,c,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s="lock",c=+a.bill+ +a.coin,l=a.password,a.locking=!0,i.next=6,b.updateLocking(e,t,n,r,o,s,c,l);case 6:return i.next=8,b.getLockings();case 8:a.lockings=i.sent,a.$bvModal.show("modal-done"),a.locking=!1;case 11:case"end":return i.stop()}}),i)})))()},unlock:function(e,t,n,r,o){var a=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var s,c,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s="unlock",c=0,l=null,a.unlocking=!0,i.next=6,b.updateLocking(e,t,n,r,o,s,c,l);case 6:return i.next=8,b.getLockings();case 8:a.lockings=i.sent,a.$bvModal.show("modal-done"),a.unlocking=!1;case 11:case"end":return i.stop()}}),i)})))()},handleAction:function(e){this.lockingProcess=!1,this.unlockingProcess=!1,this.btnChooseDisabled=!0;var t=this.selected[0]._id,n=this.selected[0].unit,r=this.selected[0].size,o=this.selected[0].firstprice,a=this.selected[0].nextprice;"lock"==e?this.lock(t,n,r,o,a):this.unlock(t,n,r,o,a),this.bill=null,this.coin=null,this.password="",this.passwordUnlock=""}},computed:{billState:function(){return 20==this.bill||50==this.bill||100==this.bill||400==this.bill||500==this.bill||1e3==this.bill},coinState:function(){return 1==this.coin||2==this.coin||5==this.coin||10==this.coin},passState:function(){return 6==this.password.length},passStateUnlock:function(){return this.passwordUnlock==this.selected[0].password}}},k=v,m=(n("8cad"),n("2877")),y=Object(m["a"])(k,i,s,!1,null,"15cf98c8",null),_=y.exports,w=n("5f5b"),x=n("b1e0");n("f9e3"),n("2dd8");r["default"].use(w["a"]),r["default"].use(x["a"]);var S={name:"App",components:{LockerComponent:_}},C=S,P=(n("034f"),Object(m["a"])(C,o,a,!1,null,null,null)),U=P.exports;r["default"].config.productionTip=!1,new r["default"]({render:function(e){return e(U)}}).$mount("#app")},"85ec":function(e,t,n){},"8cad":function(e,t,n){"use strict";var r=n("c22f"),o=n.n(r);o.a},c22f:function(e,t,n){}});
//# sourceMappingURL=app.69510578.js.map